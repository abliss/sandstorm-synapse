/*! For license information please see 1.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[1,19],{1567:function(e,t,a){var s,r=r||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,a=function(){return e.URL||e.webkitURL||e},s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in s,n=/constructor/i.test(e.HTMLElement)||e.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),c=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},i=function(e){setTimeout((function(){"string"==typeof e?a().revokeObjectURL(e):e.remove()}),4e4)},l=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},u=function(t,u,h){h||(t=l(t));var p,m=this,d="application/octet-stream"===t.type,b=function(){!function(e,t,a){for(var s=(t=[].concat(t)).length;s--;){var r=e["on"+t[s]];if("function"==typeof r)try{r.call(e,a||e)}catch(e){c(e)}}}(m,"writestart progress write writeend".split(" "))};if(m.readyState=m.INIT,r)return p=a().createObjectURL(t),void setTimeout((function(){var e,t;s.href=p,s.download=u,e=s,t=new MouseEvent("click"),e.dispatchEvent(t),b(),i(p),m.readyState=m.DONE}));!function(){if((o||d&&n)&&e.FileReader){var s=new FileReader;return s.onloadend=function(){var t=o?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,m.readyState=m.DONE,b()},s.readAsDataURL(t),void(m.readyState=m.INIT)}(p||(p=a().createObjectURL(t)),d)?e.location.href=p:e.open(p,"_blank")||(e.location.href=p);m.readyState=m.DONE,b(),i(p)}()},h=u.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,a){return t=t||e.name||"download",a||(e=l(e)),navigator.msSaveOrOpenBlob(e,t)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t,a){return new u(e,t||e.name||"download",a)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);e.exports?e.exports.saveAs=r:null!==a(1568)&&null!==a(1569)&&(void 0===(s=function(){return r}.call(t,a,t,e))||(e.exports=s))},1568:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},1569:function(e,t){(function(t){e.exports=t}).call(this,{})},1570:function(e,t,a){"use strict";a.r(t),a.d(t,"scorePassword",(function(){return i}));var s=a(1572),r=a.n(s),n=a(4),o=a(1);const c=["riot","matrix"];function i(e){if(0===e.length)return null;const t=c.slice();n.a.get()&&t.push(n.a.get().getUserIdLocalpart());let a=r()(e,t);if(e.includes(" ")){const s=r()(e.replace(/ /g,""),t);s.score<a.score&&(a=s)}for(let e=0;e<a.feedback.suggestions.length;++e)a.feedback.suggestions[e]=Object(o.a)(a.feedback.suggestions[e]);return a.feedback.warning&&(a.feedback.warning=Object(o.a)(a.feedback.warning)),a}Object(o.b)("Use a few words, avoid common phrases"),Object(o.b)("No need for symbols, digits, or uppercase letters"),Object(o.b)("Use a longer keyboard pattern with more turns"),Object(o.b)("Avoid repeated words and characters"),Object(o.b)("Avoid sequences"),Object(o.b)("Avoid recent years"),Object(o.b)("Avoid years that are associated with you"),Object(o.b)("Avoid dates and years that are associated with you"),Object(o.b)("Capitalization doesn't help very much"),Object(o.b)("All-uppercase is almost as easy to guess as all-lowercase"),Object(o.b)("Reversed words aren't much harder to guess"),Object(o.b)("Predictable substitutions like '@' instead of 'a' don't help very much"),Object(o.b)("Add another word or two. Uncommon words are better."),Object(o.b)('Repeats like "aaa" are easy to guess'),Object(o.b)('Repeats like "abcabcabc" are only slightly harder to guess than "abc"'),Object(o.b)("Sequences like abc or 6543 are easy to guess"),Object(o.b)("Recent years are easy to guess"),Object(o.b)("Dates are often easy to guess"),Object(o.b)("This is a top-10 common password"),Object(o.b)("This is a top-100 common password"),Object(o.b)("This is a very common password"),Object(o.b)("This is similar to a commonly used password"),Object(o.b)("A word by itself is easy to guess"),Object(o.b)("Names and surnames by themselves are easy to guess"),Object(o.b)("Common names and surnames are easy to guess"),Object(o.b)("Straight rows of keys are easy to guess"),Object(o.b)("Short keyboard patterns are easy to guess")},1575:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return f}));var s=a(5),r=a.n(s),n=a(0),o=a.n(n),c=a(1567),i=a.n(c),l=a(3),u=a(4),h=a(2),p=a.n(h),m=a(1570),d=a(1),b=a(107),y=a(8);const k=0,v=5;class f extends o.a.PureComponent{constructor(e){super(e),r()(this,"_collectRecoveryKeyNode",e=>{this._recoveryKeyNode=e}),r()(this,"_onCopyClick",()=>{!function(e){const t=document.createRange();t.selectNodeContents(e);const a=window.getSelection();a.removeAllRanges(),a.addRange(t)}(this._recoveryKeyNode),document.execCommand("copy")&&this.setState({copied:!0,phase:3})}),r()(this,"_onDownloadClick",()=>{const e=new Blob([this._keyBackupInfo.recovery_key],{type:"text/plain;charset=us-ascii"});i.a.saveAs(e,"recovery-key.txt"),this.setState({downloaded:!0,phase:3})}),r()(this,"_createBackup",async()=>{const{secureSecretStorage:e}=this.state;let t;this.setState({phase:4,error:null});try{e?await Object(b.a)(async()=>{t=await u.a.get().prepareKeyBackupVersion(null,{secureSecretStorage:!0}),t=await u.a.get().createKeyBackupVersion(t)}):t=await u.a.get().createKeyBackupVersion(this._keyBackupInfo),await u.a.get().scheduleAllGroupSessionsForBackup(),this.setState({phase:v})}catch(e){console.error("Error creating key backup",e),t&&u.a.get().deleteKeyBackupVersion(t.version),this.setState({error:e})}}),r()(this,"_onCancel",()=>{this.props.onFinished(!1)}),r()(this,"_onDone",()=>{this.props.onFinished(!0)}),r()(this,"_onOptOutClick",()=>{this.setState({phase:6})}),r()(this,"_onSetUpClick",()=>{this.setState({phase:k})}),r()(this,"_onSkipPassPhraseClick",async()=>{this._keyBackupInfo=await u.a.get().prepareKeyBackupVersion(),this.setState({copied:!1,downloaded:!1,phase:2})}),r()(this,"_onPassPhraseNextClick",()=>{this.setState({phase:1})}),r()(this,"_onPassPhraseKeyPress",async e=>{"Enter"===e.key&&(null!==this._setZxcvbnResultTimeout&&(clearTimeout(this._setZxcvbnResultTimeout),this._setZxcvbnResultTimeout=null,await new Promise(e=>{this.setState({zxcvbnResult:Object(m.scorePassword)(this.state.passPhrase)},e)})),this._passPhraseIsValid()&&this._onPassPhraseNextClick())}),r()(this,"_onPassPhraseConfirmNextClick",async()=>{this._keyBackupInfo=await u.a.get().prepareKeyBackupVersion(this.state.passPhrase),this.setState({setPassPhrase:!0,copied:!1,downloaded:!1,phase:2})}),r()(this,"_onPassPhraseConfirmKeyPress",e=>{"Enter"===e.key&&this.state.passPhrase===this.state.passPhraseConfirm&&this._onPassPhraseConfirmNextClick()}),r()(this,"_onSetAgainClick",()=>{this.setState({passPhrase:"",passPhraseConfirm:"",phase:k,zxcvbnResult:null})}),r()(this,"_onKeepItSafeBackClick",()=>{this.setState({phase:2})}),r()(this,"_onPassPhraseChange",e=>{this.setState({passPhrase:e.target.value}),null!==this._setZxcvbnResultTimeout&&clearTimeout(this._setZxcvbnResultTimeout),this._setZxcvbnResultTimeout=setTimeout(()=>{this._setZxcvbnResultTimeout=null,this.setState({zxcvbnResult:Object(m.scorePassword)(this.state.passPhrase)})},500)}),r()(this,"_onPassPhraseConfirmChange",e=>{this.setState({passPhraseConfirm:e.target.value})}),this._recoveryKeyNode=null,this._keyBackupInfo=null,this._setZxcvbnResultTimeout=null,this.state={secureSecretStorage:e.secureSecretStorage,phase:k,passPhrase:"",passPhraseConfirm:"",copied:!1,downloaded:!1,zxcvbnResult:null,setPassPhrase:!1},void 0===this.state.secureSecretStorage&&(this.state.secureSecretStorage=y.b.isFeatureEnabled("feature_cross_signing")),this.state.secureSecretStorage&&(this.state.phase=4)}componentDidMount(){this.state.secureSecretStorage&&this._createBackup()}componentWillUnmount(){null!==this._setZxcvbnResultTimeout&&clearTimeout(this._setZxcvbnResultTimeout)}_passPhraseIsValid(){return this.state.zxcvbnResult&&this.state.zxcvbnResult.score>=4}_renderPhasePassPhrase(){const e=l.a("views.elements.DialogButtons");let t,a;if(this.state.zxcvbnResult){if(this.state.zxcvbnResult.score>=4)a=Object(d.a)("Great! This passphrase looks strong enough.");else{const e=[];for(let t=0;t<this.state.zxcvbnResult.feedback.suggestions.length;++t)e.push(o.a.createElement("div",{key:t},this.state.zxcvbnResult.feedback.suggestions[t]));const t=o.a.createElement("div",null,e.length>0?e:Object(d.a)("Keep going..."));a=o.a.createElement("div",null,this.state.zxcvbnResult.feedback.warning,t)}t=o.a.createElement("div",null,o.a.createElement("progress",{max:4,value:this.state.zxcvbnResult.score}))}return o.a.createElement("div",null,o.a.createElement("p",null,Object(d.a)("<b>Warning</b>: You should only set up key backup from a trusted computer.",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("p",null,Object(d.a)("We'll store an encrypted copy of your keys on our server. Protect your backup with a passphrase to keep it secure.")),o.a.createElement("p",null,Object(d.a)("For maximum security, this should be different from your account password.")),o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_primaryContainer"},o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_passPhraseContainer"},o.a.createElement("input",{type:"password",onChange:this._onPassPhraseChange,onKeyPress:this._onPassPhraseKeyPress,value:this.state.passPhrase,className:"mx_CreateKeyBackupDialog_passPhraseInput",placeholder:Object(d.a)("Enter a passphrase..."),autoFocus:!0}),o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_passPhraseHelp"},t,a))),o.a.createElement(e,{primaryButton:Object(d.a)("Next"),onPrimaryButtonClick:this._onPassPhraseNextClick,hasCancel:!1,disabled:!this._passPhraseIsValid()}),o.a.createElement("details",null,o.a.createElement("summary",null,Object(d.a)("Advanced")),o.a.createElement("p",null,o.a.createElement("button",{onClick:this._onSkipPassPhraseClick},Object(d.a)("Set up with a Recovery Key")))))}_renderPhasePassPhraseConfirm(){const e=l.a("elements.AccessibleButton");let t;this.state.passPhraseConfirm===this.state.passPhrase?t=Object(d.a)("That matches!"):this.state.passPhrase.startsWith(this.state.passPhraseConfirm)||(t=Object(d.a)("That doesn't match."));let a=null;t&&(a=o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_passPhraseMatch"},o.a.createElement("div",null,t),o.a.createElement("div",null,o.a.createElement(e,{element:"span",className:"mx_linkButton",onClick:this._onSetAgainClick},Object(d.a)("Go back to set it again.")))));const s=l.a("views.elements.DialogButtons");return o.a.createElement("div",null,o.a.createElement("p",null,Object(d.a)("Please enter your passphrase a second time to confirm.")),o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_primaryContainer"},o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_passPhraseContainer"},o.a.createElement("div",null,o.a.createElement("input",{type:"password",onChange:this._onPassPhraseConfirmChange,onKeyPress:this._onPassPhraseConfirmKeyPress,value:this.state.passPhraseConfirm,className:"mx_CreateKeyBackupDialog_passPhraseInput",placeholder:Object(d.a)("Repeat your passphrase..."),autoFocus:!0})),a)),o.a.createElement(s,{primaryButton:Object(d.a)("Next"),onPrimaryButtonClick:this._onPassPhraseConfirmNextClick,hasCancel:!1,disabled:this.state.passPhrase!==this.state.passPhraseConfirm}))}_renderPhaseShowKey(){let e;return e=this.state.setPassPhrase?Object(d.a)("As a safety net, you can use it to restore your encrypted message history if you forget your Recovery Passphrase."):Object(d.a)("As a safety net, you can use it to restore your encrypted message history."),o.a.createElement("div",null,o.a.createElement("p",null,Object(d.a)("Your recovery key is a safety net - you can use it to restore access to your encrypted messages if you forget your passphrase.")),o.a.createElement("p",null,Object(d.a)("Keep your recovery key somewhere very secure, like a password manager (or a safe).")),o.a.createElement("p",null,e),o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_primaryContainer"},o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_recoveryKeyHeader"},Object(d.a)("Your Recovery Key")),o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_recoveryKeyContainer"},o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_recoveryKey"},o.a.createElement("code",{ref:this._collectRecoveryKeyNode},this._keyBackupInfo.recovery_key)),o.a.createElement("div",{className:"mx_CreateKeyBackupDialog_recoveryKeyButtons"},o.a.createElement("button",{className:"mx_Dialog_primary",onClick:this._onCopyClick},Object(d.a)("Copy to clipboard")),o.a.createElement("button",{className:"mx_Dialog_primary",onClick:this._onDownloadClick},Object(d.a)("Download"))))))}_renderPhaseKeepItSafe(){let e;this.state.copied?e=Object(d.a)("Your recovery key has been <b>copied to your clipboard</b>, paste it to:",{},{b:e=>o.a.createElement("b",null,e)}):this.state.downloaded&&(e=Object(d.a)("Your recovery key is in your <b>Downloads</b> folder.",{},{b:e=>o.a.createElement("b",null,e)}));const t=l.a("views.elements.DialogButtons");return o.a.createElement("div",null,e,o.a.createElement("ul",null,o.a.createElement("li",null,Object(d.a)("<b>Print it</b> and store it somewhere safe",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("li",null,Object(d.a)("<b>Save it</b> on a USB key or backup drive",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("li",null,Object(d.a)("<b>Copy it</b> to your personal cloud storage",{},{b:e=>o.a.createElement("b",null,e)}))),o.a.createElement(t,{primaryButton:Object(d.a)("OK"),onPrimaryButtonClick:this._createBackup,hasCancel:!1},o.a.createElement("button",{onClick:this._onKeepItSafeBackClick},Object(d.a)("Back"))))}_renderBusyPhase(e){const t=l.a("views.elements.Spinner");return o.a.createElement("div",null,o.a.createElement(t,null))}_renderPhaseDone(){const e=l.a("views.elements.DialogButtons");return o.a.createElement("div",null,o.a.createElement("p",null,Object(d.a)("Your keys are being backed up (the first backup could take a few minutes).")),o.a.createElement(e,{primaryButton:Object(d.a)("OK"),onPrimaryButtonClick:this._onDone,hasCancel:!1}))}_renderPhaseOptOutConfirm(){const e=l.a("views.elements.DialogButtons");return o.a.createElement("div",null,Object(d.a)("Without setting up Secure Message Recovery, you won't be able to restore your encrypted message history if you log out or use another session."),o.a.createElement(e,{primaryButton:Object(d.a)("Set up Secure Message Recovery"),onPrimaryButtonClick:this._onSetUpClick,hasCancel:!1},o.a.createElement("button",{onClick:this._onCancel},"I understand, continue without")))}_titleForPhase(e){switch(e){case k:return Object(d.a)("Secure your backup with a passphrase");case 1:return Object(d.a)("Confirm your passphrase");case 6:return Object(d.a)("Warning!");case 2:return Object(d.a)("Recovery key");case 3:return Object(d.a)("Keep it safe");case 4:return Object(d.a)("Starting backup...");case v:return Object(d.a)("Success!");default:return Object(d.a)("Create Key Backup")}}render(){const e=l.a("views.dialogs.BaseDialog");let t;if(this.state.error){const e=l.a("views.elements.DialogButtons");t=o.a.createElement("div",null,o.a.createElement("p",null,Object(d.a)("Unable to create key backup")),o.a.createElement("div",{className:"mx_Dialog_buttons"},o.a.createElement(e,{primaryButton:Object(d.a)("Retry"),onPrimaryButtonClick:this._createBackup,hasCancel:!0,onCancel:this._onCancel})))}else switch(this.state.phase){case k:t=this._renderPhasePassPhrase();break;case 1:t=this._renderPhasePassPhraseConfirm();break;case 2:t=this._renderPhaseShowKey();break;case 3:t=this._renderPhaseKeepItSafe();break;case 4:t=this._renderBusyPhase();break;case v:t=this._renderPhaseDone();break;case 6:t=this._renderPhaseOptOutConfirm()}return o.a.createElement(e,{className:"mx_CreateKeyBackupDialog",onFinished:this.props.onFinished,title:this._titleForPhase(this.state.phase),hasCancel:[k,v].includes(this.state.phase)},o.a.createElement("div",null,t))}}r()(f,"propTypes",{secureSecretStorage:p.a.bool,onFinished:p.a.func.isRequired})}}]);
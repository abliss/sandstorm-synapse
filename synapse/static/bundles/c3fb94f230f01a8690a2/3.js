/*! For license information please see 3.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[3,19],{1565:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return g}));var s=a(5),r=a.n(s),n=a(0),o=a.n(n),i=a(2),c=a.n(i),l=a(3),u=a(4),h=a(1570),d=a(1567),p=a.n(d),m=a(1),y=a(9);const b=2;class g extends o.a.PureComponent{constructor(e){super(e),r()(this,"_onKeyBackupStatusChange",()=>{1===this.state.phase&&this._fetchBackupInfo()}),r()(this,"_collectRecoveryKeyNode",e=>{this._recoveryKeyNode=e}),r()(this,"_onUseKeyBackupChange",e=>{this.setState({useKeyBackup:e})}),r()(this,"_onMigrateFormSubmit",e=>{e.preventDefault(),this.state.backupSigStatus.usable?this._bootstrapSecretStorage():this._restoreBackup()}),r()(this,"_onCopyClick",()=>{!function(e){const t=document.createRange();t.selectNodeContents(e);const a=window.getSelection();a.removeAllRanges(),a.addRange(t)}(this._recoveryKeyNode),document.execCommand("copy")&&this.setState({copied:!0,phase:5})}),r()(this,"_onDownloadClick",()=>{const e=new Blob([this._encodedRecoveryKey],{type:"text/plain;charset=us-ascii"});p.a.saveAs(e,"recovery-key.txt"),this.setState({downloaded:!0,phase:5})}),r()(this,"_doBootstrapUIAuth",async e=>{if(this.state.canUploadKeysWithPasswordOnly&&this.state.accountPassword)await e({type:"m.login.password",identifier:{type:"m.id.user",user:u.a.get().getUserId()},user:u.a.get().getUserId(),password:this.state.accountPassword});else{const t=l.a("dialogs.InteractiveAuthDialog"),{finished:a}=y.a.createTrackedDialog("Cross-signing keys dialog","",t,{title:Object(m.a)("Send cross-signing keys to homeserver"),matrixClient:u.a.get(),makeRequest:e}),[s]=await a;if(!s)throw new Error("Cross-signing key upload auth canceled")}}),r()(this,"_bootstrapSecretStorage",async()=>{this.setState({phase:6,error:null});const e=u.a.get();try{await e.bootstrapSecretStorage({authUploadDeviceSigningKeys:this._doBootstrapUIAuth,createSecretStorageKey:async()=>this._keyInfo,keyBackupInfo:this.state.backupInfo,setupNewKeyBackup:!this.state.backupInfo&&this.state.useKeyBackup}),this.setState({phase:7})}catch(e){this.state.canUploadKeysWithPasswordOnly&&401===e.httpStatus&&e.data.flows?this.setState({accountPassword:"",accountPasswordCorrect:!1,phase:1}):this.setState({error:e}),console.error("Error bootstrapping secret storage",e)}}),r()(this,"_onCancel",()=>{this.props.onFinished(!1)}),r()(this,"_onDone",()=>{this.props.onFinished(!0)}),r()(this,"_restoreBackup",async()=>{const e=l.a("dialogs.keybackup.RestoreKeyBackupDialog"),{finished:t}=y.a.createTrackedDialog("Restore Backup","",e,{showSummary:!1},null,!1,!0);await t,await this._fetchBackupInfo(),this.state.backupSigStatus.usable&&this.state.canUploadKeysWithPasswordOnly&&this.state.accountPassword&&this._bootstrapSecretStorage()}),r()(this,"_onSkipSetupClick",()=>{this.setState({phase:8})}),r()(this,"_onSetUpClick",()=>{this.setState({phase:b})}),r()(this,"_onSkipPassPhraseClick",async()=>{const[e,t]=await u.a.get().createRecoveryKeyFromPassphrase();this._keyInfo=e,this._encodedRecoveryKey=t,this.setState({copied:!1,downloaded:!1,phase:4})}),r()(this,"_onPassPhraseNextClick",()=>{this.setState({phase:3})}),r()(this,"_onPassPhraseKeyPress",async e=>{"Enter"===e.key&&(null!==this._setZxcvbnResultTimeout&&(clearTimeout(this._setZxcvbnResultTimeout),this._setZxcvbnResultTimeout=null,await new Promise(e=>{this.setState({zxcvbnResult:Object(h.scorePassword)(this.state.passPhrase)},e)})),this._passPhraseIsValid()&&this._onPassPhraseNextClick())}),r()(this,"_onPassPhraseConfirmNextClick",async()=>{const[e,t]=await u.a.get().createRecoveryKeyFromPassphrase(this.state.passPhrase);this._keyInfo=e,this._encodedRecoveryKey=t,this.setState({setPassPhrase:!0,copied:!1,downloaded:!1,phase:4})}),r()(this,"_onPassPhraseConfirmKeyPress",e=>{"Enter"===e.key&&this.state.passPhrase===this.state.passPhraseConfirm&&this._onPassPhraseConfirmNextClick()}),r()(this,"_onSetAgainClick",()=>{this.setState({passPhrase:"",passPhraseConfirm:"",phase:b,zxcvbnResult:null})}),r()(this,"_onKeepItSafeBackClick",()=>{this.setState({phase:4})}),r()(this,"_onPassPhraseChange",e=>{this.setState({passPhrase:e.target.value}),null!==this._setZxcvbnResultTimeout&&clearTimeout(this._setZxcvbnResultTimeout),this._setZxcvbnResultTimeout=setTimeout(()=>{this._setZxcvbnResultTimeout=null,this.setState({zxcvbnResult:Object(h.scorePassword)(this.state.passPhrase)})},500)}),r()(this,"_onPassPhraseConfirmChange",e=>{this.setState({passPhraseConfirm:e.target.value})}),r()(this,"_onAccountPasswordChange",e=>{this.setState({accountPassword:e.target.value})}),this._keyInfo=null,this._encodedRecoveryKey=null,this._recoveryKeyNode=null,this._setZxcvbnResultTimeout=null,this.state={phase:0,passPhrase:"",passPhraseConfirm:"",copied:!1,downloaded:!1,zxcvbnResult:null,setPassPhrase:!1,backupInfo:null,backupSigStatus:null,canUploadKeysWithPasswordOnly:null,accountPassword:e.accountPassword,accountPasswordCorrect:null,doingUpgrade:null,useKeyBackup:!0},this._fetchBackupInfo(),this._queryKeyUploadAuth(),u.a.get().on("crypto.keyBackupStatus",this._onKeyBackupStatusChange)}componentWillUnmount(){u.a.get().removeListener("crypto.keyBackupStatus",this._onKeyBackupStatusChange),null!==this._setZxcvbnResultTimeout&&clearTimeout(this._setZxcvbnResultTimeout)}async _fetchBackupInfo(){const e=await u.a.get().getKeyBackupVersion(),t=u.a.get().isCryptoEnabled()&&await u.a.get().isKeyBackupTrusted(e),a=e?1:b;this.setState({phase:a,backupInfo:e,backupSigStatus:t,doingUpgrade:1===a})}async _queryKeyUploadAuth(){try{await u.a.get().uploadDeviceSigningKeys(null,{}),console.log("uploadDeviceSigningKeys unexpectedly succeeded without UI auth!")}catch(e){e.data.flows||console.log("uploadDeviceSigningKeys advertised no flows!");const t=e.data.flows.some(e=>1===e.stages.length&&"m.login.password"===e.stages[0]);this.setState({canUploadKeysWithPasswordOnly:t})}}_passPhraseIsValid(){return this.state.zxcvbnResult&&this.state.zxcvbnResult.score>=4}_renderPhaseMigrate(){const e=l.a("views.elements.DialogButtons"),t=l.a("views.elements.Field");let a,s=Object(m.a)("Next");return this.state.backupSigStatus.usable?a=this.state.canUploadKeysWithPasswordOnly?o.a.createElement("div",null,o.a.createElement("div",null,Object(m.a)("Enter your account password to confirm the upgrade:")),o.a.createElement("div",null,o.a.createElement(t,{type:"password",id:"mx_CreateSecretStorage_accountPassword",label:Object(m.a)("Password"),value:this.state.accountPassword,onChange:this._onAccountPasswordChange,flagInvalid:!1===this.state.accountPasswordCorrect,autoFocus:!0}))):o.a.createElement("p",null,Object(m.a)("You'll need to authenticate with the server to confirm the upgrade.")):(a=o.a.createElement("div",null,o.a.createElement("div",null,Object(m.a)("Restore your key backup to upgrade your encryption"))),s=Object(m.a)("Restore")),o.a.createElement("form",{onSubmit:this._onMigrateFormSubmit},o.a.createElement("p",null,Object(m.a)("Upgrade this session to allow it to verify other sessions, granting them access to encrypted messages and marking them as trusted for other users.")),o.a.createElement("div",null,a),o.a.createElement(e,{primaryButton:s,primaryIsSubmit:!0,hasCancel:!1,primaryDisabled:this.state.canUploadKeysWithPasswordOnly&&!this.state.accountPassword},o.a.createElement("button",{type:"button",className:"danger",onClick:this._onSkipSetupClick},Object(m.a)("Skip"))))}_renderPhasePassPhrase(){const e=l.a("views.elements.DialogButtons"),t=l.a("views.elements.Field"),a=l.a("elements.AccessibleButton"),s=l.a("views.elements.LabelledToggleSwitch");let r,n;if(this.state.zxcvbnResult){if(this.state.zxcvbnResult.score>=4)n=Object(m.a)("Great! This passphrase looks strong enough.");else{const e=[];for(let t=0;t<this.state.zxcvbnResult.feedback.suggestions.length;++t)e.push(o.a.createElement("div",{key:t},this.state.zxcvbnResult.feedback.suggestions[t]));const t=o.a.createElement("div",null,e.length>0?e:Object(m.a)("Keep going..."));n=o.a.createElement("div",null,this.state.zxcvbnResult.feedback.warning,t)}r=o.a.createElement("div",null,o.a.createElement("progress",{max:4,value:this.state.zxcvbnResult.score}))}return o.a.createElement("div",null,o.a.createElement("p",null,Object(m.a)("Set up encryption on this session to allow it to verify other sessions, granting them access to encrypted messages and marking them as trusted for other users.")),o.a.createElement("p",null,Object(m.a)("Secure your encryption keys with a passphrase. For maximum security this should be different to your account password:")),o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_passPhraseContainer"},o.a.createElement(t,{type:"password",id:"mx_CreateSecretStorageDialog_passPhraseField",className:"mx_CreateSecretStorageDialog_passPhraseField",onChange:this._onPassPhraseChange,onKeyPress:this._onPassPhraseKeyPress,value:this.state.passPhrase,label:Object(m.a)("Enter a passphrase"),autoFocus:!0}),o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_passPhraseHelp"},r,n)),o.a.createElement(s,{label:Object(m.a)("Back up my encryption keys, securing them with the same passphrase"),onChange:this._onUseKeyBackupChange,value:this.state.useKeyBackup}),o.a.createElement(e,{primaryButton:Object(m.a)("Continue"),onPrimaryButtonClick:this._onPassPhraseNextClick,hasCancel:!1,disabled:!this._passPhraseIsValid()},o.a.createElement("button",{type:"button",onClick:this._onSkipSetupClick,className:"danger"},Object(m.a)("Skip"))),o.a.createElement("details",null,o.a.createElement("summary",null,Object(m.a)("Advanced")),o.a.createElement(a,{kind:"primary",onClick:this._onSkipPassPhraseClick},Object(m.a)("Set up with a recovery key"))))}_renderPhasePassPhraseConfirm(){const e=l.a("elements.AccessibleButton"),t=l.a("views.elements.Field");let a;this.state.passPhraseConfirm===this.state.passPhrase?a=Object(m.a)("That matches!"):this.state.passPhrase.startsWith(this.state.passPhraseConfirm)||(a=Object(m.a)("That doesn't match."));let s=null;a&&(s=o.a.createElement("div",null,o.a.createElement("div",null,a),o.a.createElement("div",null,o.a.createElement(e,{element:"span",className:"mx_linkButton",onClick:this._onSetAgainClick},Object(m.a)("Go back to set it again.")))));const r=l.a("views.elements.DialogButtons");return o.a.createElement("div",null,o.a.createElement("p",null,Object(m.a)("Enter your passphrase a second time to confirm it.")),o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_passPhraseContainer"},o.a.createElement(t,{type:"password",id:"mx_CreateSecretStorageDialog_passPhraseField",onChange:this._onPassPhraseConfirmChange,onKeyPress:this._onPassPhraseConfirmKeyPress,value:this.state.passPhraseConfirm,className:"mx_CreateSecretStorageDialog_passPhraseField",label:Object(m.a)("Confirm your passphrase"),autoFocus:!0}),o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_passPhraseMatch"},s)),o.a.createElement(r,{primaryButton:Object(m.a)("Continue"),onPrimaryButtonClick:this._onPassPhraseConfirmNextClick,hasCancel:!1,disabled:this.state.passPhrase!==this.state.passPhraseConfirm},o.a.createElement("button",{type:"button",onClick:this._onSkipSetupClick,className:"danger"},Object(m.a)("Skip"))))}_renderPhaseShowKey(){let e;e=this.state.setPassPhrase?Object(m.a)("As a safety net, you can use it to restore your access to encrypted messages if you forget your passphrase."):Object(m.a)("As a safety net, you can use it to restore your access to encrypted messages.");const t=l.a("elements.AccessibleButton");return o.a.createElement("div",null,o.a.createElement("p",null,Object(m.a)("Your recovery key is a safety net - you can use it to restore access to your encrypted messages if you forget your passphrase.")),o.a.createElement("p",null,Object(m.a)("Keep your recovery key somewhere very secure, like a password manager (or a safe).")),o.a.createElement("p",null,e),o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_primaryContainer"},o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_recoveryKeyHeader"},Object(m.a)("Your Recovery Key")),o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_recoveryKeyContainer"},o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_recoveryKey"},o.a.createElement("code",{ref:this._collectRecoveryKeyNode},this._encodedRecoveryKey)),o.a.createElement("div",{className:"mx_CreateSecretStorageDialog_recoveryKeyButtons"},o.a.createElement(t,{kind:"primary",className:"mx_Dialog_primary",onClick:this._onCopyClick},Object(m.a)("Copy to clipboard")),o.a.createElement(t,{kind:"primary",className:"mx_Dialog_primary",onClick:this._onDownloadClick},Object(m.a)("Download"))))))}_renderPhaseKeepItSafe(){let e;this.state.copied?e=Object(m.a)("Your recovery key has been <b>copied to your clipboard</b>, paste it to:",{},{b:e=>o.a.createElement("b",null,e)}):this.state.downloaded&&(e=Object(m.a)("Your recovery key is in your <b>Downloads</b> folder.",{},{b:e=>o.a.createElement("b",null,e)}));const t=l.a("views.elements.DialogButtons");return o.a.createElement("div",null,e,o.a.createElement("ul",null,o.a.createElement("li",null,Object(m.a)("<b>Print it</b> and store it somewhere safe",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("li",null,Object(m.a)("<b>Save it</b> on a USB key or backup drive",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("li",null,Object(m.a)("<b>Copy it</b> to your personal cloud storage",{},{b:e=>o.a.createElement("b",null,e)}))),o.a.createElement(t,{primaryButton:Object(m.a)("OK"),onPrimaryButtonClick:this._bootstrapSecretStorage,hasCancel:!1},o.a.createElement("button",{onClick:this._onKeepItSafeBackClick},Object(m.a)("Back"))))}_renderBusyPhase(){const e=l.a("views.elements.Spinner");return o.a.createElement("div",null,o.a.createElement(e,null))}_renderPhaseDone(){const e=l.a("views.elements.DialogButtons");return o.a.createElement("div",null,o.a.createElement("p",null,Object(m.a)("This session can now verify other sessions, granting them access to encrypted messages and marking them as trusted for other users.")),o.a.createElement("p",null,Object(m.a)("Verify other users in their profile.")),o.a.createElement(e,{primaryButton:Object(m.a)("OK"),onPrimaryButtonClick:this._onDone,hasCancel:!1}))}_renderPhaseSkipConfirm(){const e=l.a("views.elements.DialogButtons");return o.a.createElement("div",null,Object(m.a)("Without completing security on this session, it won’t have access to encrypted messages."),o.a.createElement(e,{primaryButton:Object(m.a)("Go back"),onPrimaryButtonClick:this._onSetUpClick,hasCancel:!1},o.a.createElement("button",{type:"button",className:"danger",onClick:this._onCancel},Object(m.a)("Skip"))))}_titleForPhase(e){switch(e){case 1:return Object(m.a)("Upgrade your encryption");case b:return Object(m.a)("Set up encryption");case 3:return Object(m.a)("Confirm passphrase");case 8:return Object(m.a)("Are you sure?");case 4:return Object(m.a)("Recovery key");case 5:return Object(m.a)("Keep it safe");case 6:return Object(m.a)("Storing secrets...");case 7:return this.state.doingUpgrade?Object(m.a)("Encryption upgraded"):Object(m.a)("Encryption setup complete");default:return""}}render(){const e=l.a("views.dialogs.BaseDialog");let t,s;if(this.state.error){const e=l.a("views.elements.DialogButtons");t=o.a.createElement("div",null,o.a.createElement("p",null,Object(m.a)("Unable to set up secret storage")),o.a.createElement("div",{className:"mx_Dialog_buttons"},o.a.createElement(e,{primaryButton:Object(m.a)("Retry"),onPrimaryButtonClick:this._bootstrapSecretStorage,hasCancel:!0,onCancel:this._onCancel})))}else switch(this.state.phase){case 0:t=this._renderBusyPhase();break;case 1:t=this._renderPhaseMigrate();break;case b:t=this._renderPhasePassPhrase();break;case 3:t=this._renderPhasePassPhraseConfirm();break;case 4:t=this._renderPhaseShowKey();break;case 5:t=this._renderPhaseKeepItSafe();break;case 6:t=this._renderBusyPhase();break;case 7:t=this._renderPhaseDone();break;case 8:t=this._renderPhaseSkipConfirm()}return this._titleForPhase(this.state.phase)&&(s=a(1580)),o.a.createElement(e,{className:"mx_CreateSecretStorageDialog",onFinished:this.props.onFinished,title:this._titleForPhase(this.state.phase),headerImage:s,hasCancel:this.props.hasCancel&&[b].includes(this.state.phase),fixedWidth:!1},o.a.createElement("div",null,t))}}r()(g,"propTypes",{hasCancel:c.a.bool,accountPassword:c.a.string}),r()(g,"defaultProps",{hasCancel:!0})},1567:function(e,t,a){var s,r=r||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,a=function(){return e.URL||e.webkitURL||e},s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in s,n=/constructor/i.test(e.HTMLElement)||e.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},c=function(e){setTimeout((function(){"string"==typeof e?a().revokeObjectURL(e):e.remove()}),4e4)},l=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},u=function(t,u,h){h||(t=l(t));var d,p=this,m="application/octet-stream"===t.type,y=function(){!function(e,t,a){for(var s=(t=[].concat(t)).length;s--;){var r=e["on"+t[s]];if("function"==typeof r)try{r.call(e,a||e)}catch(e){i(e)}}}(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,r)return d=a().createObjectURL(t),void setTimeout((function(){var e,t;s.href=d,s.download=u,e=s,t=new MouseEvent("click"),e.dispatchEvent(t),y(),c(d),p.readyState=p.DONE}));!function(){if((o||m&&n)&&e.FileReader){var s=new FileReader;return s.onloadend=function(){var t=o?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,p.readyState=p.DONE,y()},s.readAsDataURL(t),void(p.readyState=p.INIT)}(d||(d=a().createObjectURL(t)),m)?e.location.href=d:e.open(d,"_blank")||(e.location.href=d);p.readyState=p.DONE,y(),c(d)}()},h=u.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,a){return t=t||e.name||"download",a||(e=l(e)),navigator.msSaveOrOpenBlob(e,t)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t,a){return new u(e,t||e.name||"download",a)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);e.exports?e.exports.saveAs=r:null!==a(1568)&&null!==a(1569)&&(void 0===(s=function(){return r}.call(t,a,t,e))||(e.exports=s))},1568:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},1569:function(e,t){(function(t){e.exports=t}).call(this,{})},1570:function(e,t,a){"use strict";a.r(t),a.d(t,"scorePassword",(function(){return c}));var s=a(1572),r=a.n(s),n=a(4),o=a(1);const i=["riot","matrix"];function c(e){if(0===e.length)return null;const t=i.slice();n.a.get()&&t.push(n.a.get().getUserIdLocalpart());let a=r()(e,t);if(e.includes(" ")){const s=r()(e.replace(/ /g,""),t);s.score<a.score&&(a=s)}for(let e=0;e<a.feedback.suggestions.length;++e)a.feedback.suggestions[e]=Object(o.a)(a.feedback.suggestions[e]);return a.feedback.warning&&(a.feedback.warning=Object(o.a)(a.feedback.warning)),a}Object(o.b)("Use a few words, avoid common phrases"),Object(o.b)("No need for symbols, digits, or uppercase letters"),Object(o.b)("Use a longer keyboard pattern with more turns"),Object(o.b)("Avoid repeated words and characters"),Object(o.b)("Avoid sequences"),Object(o.b)("Avoid recent years"),Object(o.b)("Avoid years that are associated with you"),Object(o.b)("Avoid dates and years that are associated with you"),Object(o.b)("Capitalization doesn't help very much"),Object(o.b)("All-uppercase is almost as easy to guess as all-lowercase"),Object(o.b)("Reversed words aren't much harder to guess"),Object(o.b)("Predictable substitutions like '@' instead of 'a' don't help very much"),Object(o.b)("Add another word or two. Uncommon words are better."),Object(o.b)('Repeats like "aaa" are easy to guess'),Object(o.b)('Repeats like "abcabcabc" are only slightly harder to guess than "abc"'),Object(o.b)("Sequences like abc or 6543 are easy to guess"),Object(o.b)("Recent years are easy to guess"),Object(o.b)("Dates are often easy to guess"),Object(o.b)("This is a top-10 common password"),Object(o.b)("This is a top-100 common password"),Object(o.b)("This is a very common password"),Object(o.b)("This is similar to a commonly used password"),Object(o.b)("A word by itself is easy to guess"),Object(o.b)("Names and surnames by themselves are easy to guess"),Object(o.b)("Common names and surnames are easy to guess"),Object(o.b)("Straight rows of keys are easy to guess"),Object(o.b)("Short keyboard patterns are easy to guess")},1580:function(e,t){e.exports="img/e2e/normal.38c8458.svg"}}]);